<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>缴费项目管理</title>
    <meta name="description" >
    <link rel="shortcut icon" href="favicon.ico">
    <link href="../resource/css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="../resource/css/font-awesome.css?v=4.4.0" rel="stylesheet">
    <link href="../resource/js/plugins/bootstarp-table/css/bootstrap-table.min.css" rel="stylesheet">
    <link href="../resource/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css" rel="stylesheet">

    <link href="../resource/css/animate.css" rel="stylesheet">
    <link href="../resource/css/style.css?v=4.1.0" rel="stylesheet">
    <link href="../resource/css/common.css" rel="stylesheet">

    <style>
        html, address,blockquote,body, dd, div,dl, dt, fieldset, form,frame, frameset,h1, h2, h3, h4,h5, h6, noframes,ol, p, ul, center,dir, hr, menu, pre { display: block }
        ul{
            list-style: none;padding:0;
        }
        li { display: list-item }

        .fl{
            float:left;
        }
        .fr{
            float:right;
        }
        ul{
            clear:both;
            border:1px solid #dbdbdb;
            padding:7px 0 ;
        }
        .modal-body-top{
            font-size: 14px;
            color:#ee415b;
            line-height: 30px;
            margin-bottom: 10px;
        }
        button{
            background:#52bb5c;
            color:#fff;
            border:none;
            outline: none;
            line-height: 30px;
            padding:0 12px;
        }
        ul li{
            font-size: 14px;
            color:#000;
            float:left;
            padding:7px 20px;
        }
        .gray{
            display:inline-block;
            width:12px;
            height:12px;
            background:#cbcbcb;
            margin-right:4px;
        }
        .green{
            background:#54b362;
            display:inline-block;
            width:12px;
            height:12px;
            margin-right:4px;
        }
        .red{
            background:#ee415b;
            display:inline-block;
            width:12px;
            height:12px;
            margin-right:4px;
        }
    </style>

</head>

<body class="gray-bg">

<div class="wrapper wrapper-content animated  fadeInDown  content-view-sub-4" style="display: none">
    <div id="chargeItems">
    </div>
</div>



<div class="wrapper wrapper-content animated  fadeInDown  content-view-sub-3" style="display: none">
    <form method="get" class="form-horizontal" id="sub3AreaForm">
        <div class="form-group">
            <label class="col-sm-3 control-label">备注</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="infoDesc" placeholder="请输入备注"/>
                <span class="help-block m-b-none validate">请输入备注</span>
            </div>
        </div>
    </form>
</div>

<div class="wrapper wrapper-content animated  fadeInDown  content-view-sub-2" style="display: none">
    <table id="sub_2_tb_table"></table>
</div>


<div class="wrapper wrapper-content animated  fadeInDown  content-view-sub" style="display: none">
    <form method="get" class="form-horizontal" id="subAreaForm">
        <div class="form-group">
            <label class="col-sm-3 control-label">缴费对象</label>
            <div class="col-sm-8">
                <input type="text" class="form-control" id="uids" placeholder="请输入缴费对象"/>
                <span class="help-block m-b-none validate">请输入缴费对象</span>
            </div>
        </div>
    </form>
    <table id="sub_tb_table"></table>
</div>



<div class="wrapper wrapper-content animated  fadeInDown  content-view">
    <form method="get" class="form-horizontal" id="areaForm">
        <div class="form-group">
            <label class="col-sm-3 control-label">项目名称</label>
            <div class="col-sm-8">
                <input type="text" class="form-control"  id="name" placeholder="请输入项目名称"/>
                <span class="help-block m-b-none validate">请输入项目名称</span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">包含子项目</label>
            <div class="col-sm-8">
                <ul id="selectSubs" style="padding: 0; border:none">
                </ul>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">描述</label>
            <div class="col-sm-8">
                <input type="text" class="form-control"  id="desc" placeholder="请输入描述"/>
                <span class="help-block m-b-none validate">请输入描述</span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-3 control-label">缴费有效期</label>
            <div class="col-sm-8">
                <input type="text" class="form-control"  id="overtime" placeholder="请输入缴费有效期"/>
                <span class="help-block m-b-none validate">请输入缴费有效期</span>
            </div>
        </div>

    </form>
</div>


<form style="opacity: 0" action="" id="uploadForm" autocomplete="off" enctype="multipart/form-data">
    <input style="height: 0;width: 0;" type="file" name="file"   accept="image/jpeg，image/jpg，image/png,image/jp2，image/jpe" />
</form>

<div class="wrapper wrapper-content animated fadeInRight">
    <!-- Panel Other -->
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>功能列表</h5>
        </div>
        <div id="toolbar" class="form-group">
            <label class="col-sm-1 control-label">开始时间</label>
            <div class="col-sm-2">
                <input type="text" id="startTime" class="form-control"  placeholder="请选择开始时间" readonly>
            </div>
            <label class="col-sm-1 control-label">结束时间</label>
            <div class="col-sm-2">
                <input type="text" id="endTime" class="form-control"  placeholder="请选择结束时间" readonly>
            </div>
            <label class="col-sm-1 control-label">项目名称</label>
            <div class="col-sm-2">
                <input type="text" class="form-control" id="searchName" placeholder="请输入项目名称">
                <span class="help-block m-b-none validate">请输入项目名称</span>
            </div>
            <div class="col-sm-3" >
                <button type="button" class="btn  btn-info " id="search" name="like_search">
                    <i class="fa fa-search"></i> 点击查询
                </button>
            </div>
            <button class="btn btn-success  btn-outline" id="btn_add">
                <i class="fa fa-plus">添加</i>
            </button>
        </div>
        <div class="ibox-content">
            <div class="row row-lg">
                <div class="col-sm-12">
                    <table id="tb_table"></table>
                </div>
            </div>
        </div>
    </div>
    <!-- End Panel Other -->
</div>

<!-- 全局js -->
<script src="../resource/js/jquery.min.js?v=2.1.4"></script>
<script src="../resource/js/bootstrap.min.js?v=3.3.6"></script>

<!-- 自定义js -->
<script src="../resource/js/content.js?v=1.0.0"></script>
<script src="../resource/js/plugins/laydate/laydate.js"></script>
<script src="../resource/js/plugins/layer/layer.js"></script>

<!-- Bootstrap table -->
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table.js"></script>
<script src="../resource/js/plugins/bootstarp-table/js/bootstrap-table-zh-CN.min.js"></script>
<script src="../resource/js/template-native.js"></script>


<script src="../resource/common/common.js?"+Math.random()></script>
<script>
//    var schoolId=getUserInfo().sid;
    var schoolId=getQueryString("sid");
    var subsMap = {};
    var $table =  $('#tb_table');
    var startTime =  isBlank($("#startTime").val()) ? 0 : new Date($("#startTime").val()).getTime();
    var endTime = isBlank($("#endTime").val()) ? 0 : new Date($("#endTime").val()).getTime();
    var $sub2Table =  $('#sub_2_tb_table');

    var Sub2TableInit = function (columns) {
        var oTableInit = new Object();
        //初始化Table
        oTableInit.Init = function () {
            $sub2Table.bootstrapTable({
                method: 'get',                      //请求方式（*）
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination: true,                   //是否显示分页（*）
                sortable: false,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber:1,                       //初始化加载第一页，默认第一页
                pageSize: 5,                       //每页的记录行数（*）
                pageList: [5,10,15],        //可供选择的每页的行数（*）
//                search: true,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                strictSearch: true,
                showColumns: true,                  //是否显示所有的列
//				showRefresh: true,                  //是否显示刷新按钮
                minimumCountColumns: 2,             //最少允许的列数
                clickToSelect: true,                //是否启用点击选中行
//				height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                uniqueId: "id",                     //每一行的唯一标识，一般为主键列
//                showToggle:true,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                   //是否显示父子表
                columns: columns,
//                    showFooter:true,            //表格底部
                onClickRow: function (row) {
//                        console.log(row)
                },
                queryParamsType:'limit',
                queryParams: function (params) {
                    var startTime =  isBlank($("#startTime").val()) ? 0 : new Date($("#startTime").val()).getTime();
                    var endTime = isBlank($("#endTime").val()) ? 0 : new Date($("#endTime").val()).getTime();
                    return {
                        token:getUserInfo().token,
                        page:(params.offset / params.limit) + 1,
                        size: params.limit,
                        startTime:isBlank(startTime)?0:new Date(startTime).getTime(),
                        endTime :isBlank(endTime)?0:new Date(endTime).getTime(),
                        name:$("#searchName").val(),
                    };
                },
            });
        };
        return oTableInit;
    };


    var TableInit = function (columns) {
        var oTableInit = new Object();
        //初始化Table
        oTableInit.Init = function () {
            $table.bootstrapTable({
                url: serverUrl+'/charge/getUserPager?sid=' + schoolId,         //请求后台的URL（*）
                method: 'get',                      //请求方式（*）
                toolbar: '#toolbar',                //工具按钮用哪个容器
//                    striped: true,                      //是否显示行间隔色
                cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
                pagination: true,                   //是否显示分页（*）
                sortable: false,                     //是否启用排序
                sortOrder: "asc",                   //排序方式
                sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）
                pageNumber:1,                       //初始化加载第一页，默认第一页
                pageSize: 10,                       //每页的记录行数（*）
                pageList: [10,20,30],        //可供选择的每页的行数（*）
//                search: true,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
                strictSearch: true,
                showColumns: true,                  //是否显示所有的列
//				showRefresh: true,                  //是否显示刷新按钮
                minimumCountColumns: 2,             //最少允许的列数
                clickToSelect: true,                //是否启用点击选中行
//				height: 500,                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度
                uniqueId: "id",                     //每一行的唯一标识，一般为主键列
//                showToggle:true,                    //是否显示详细视图和列表视图的切换按钮
                cardView: false,                    //是否显示详细视图
                detailView: false,                   //是否显示父子表
                columns: columns,
//                    showFooter:true,            //表格底部
                onClickRow: function (row) {
//                        console.log(row)
                },
                queryParamsType:'limit',
                queryParams: function (params) {
                    var startTime =  isBlank($("#startTime").val()) ? 0 : new Date($("#startTime").val()).getTime();
                    var endTime = isBlank($("#endTime").val()) ? 0 : new Date($("#endTime").val()).getTime();
                    return {
                        token:getUserInfo().token,
                        page:(params.offset / params.limit) + 1,
                        size: params.limit,
                        startTime:isBlank(startTime)?0:new Date(startTime).getTime(),
                        endTime :isBlank(endTime)?0:new Date(endTime).getTime(),
                        name:$("#searchName").val(),
                    };
                },
            });
        };
        return oTableInit;
    };

    var sub2Columns = [
        {field: "id", title: "序号",align:"center",formatter: function (value, row, index) {
            return index+1;
        }},
        {field: "name", title: "缴费名称",align: "center" ,formatter: function (value, row, index) {
            return value;
        }},
        {field: "userName", title: "用户",align: "center" ,formatter: function (value, row, index) {
            return value;
        }},
        {field: "pay", title: "是否缴费",align: "center" ,formatter: function (value, row, index) {
            var content = '';
            if(value == 0) content += '否';
            else content += '是';
            return content;
        }},
        {field: "payTime", title: "缴费时间",align: "center" ,formatter: function (value, row, index) {
            var content = '';
            if(value == 0) content += '';
            else content += value;
            return formatDateTime(content);
        }},
        {field: "refund", title: "是否退费",align: "center" ,formatter: function (value, row, index) {
            var content = '';
            if(row.refundFee > 0) content += '是';
            else content += '否';
            return content;
        }},
        {field: "refundFee", title: "退费金额",align: "center" ,formatter: function (value, row, index) {
            return value;
        }},
        {field: "price", title: "应收金额（元）",align: "center" ,formatter: function (value, row, index) {
            return value;
        }},
        {field: "status", title: "缴费项目状态",align: "center" ,formatter: function (value, row, index) {
            var content = '';
            if(value == 0) content += '开启';
            else content += '关闭';
            return content;
        }},
        {field: "desc", title: "备注",align: "center" ,formatter: function (value, row, index) {
            return value;
        }},
        {field: "other", title: "编辑", align: "center", formatter: function (value, row, index) {
            var html = '';
            if(row.pay == 1 && row.refundFee == 0) {
                html += '<a class="btn btn-danger btn-sm btn-outline" href="javascript:void(0);" title="退款" onclick=\'refund('+JSON.stringify(row)+')\' >退款</a>';
            }
            html += ' <a class="btn btn-danger btn-sm btn-outline" href="javascript:void(0);" title="修改备注" onclick=\'updateUserChargeInfoDesc('+JSON.stringify(row)+')\' >修改备注</a>';
            return html;
        }}
    ];

    var columns = [
        {field: "id",title: "序号",align:"center",formatter: function (value, row, index) {
            return index+1;
        }},
        {field: "name", title: "项目名称",align: "center", formatter: function (value, row, index) {
            return value;
        }},
        {field: "chargeItemPricesJson", title: "子项目",align: "center", formatter: function (value, row, index) {
            var itemList = JSON.parse(value);
            var content = '';
            for(var i = 0; i < itemList.length; i++) {
                var one = itemList[i];
                content += '子项目名称 : ' + one.name + ', 价格 ：' + one.price + '<br/>';
            }
            return content;
        }},
        {field: "desc", title: "描述",align: "center", formatter: function (value, row, index) {
            return value;
        }},
        {field: "ctime", title: "发布日期",align: "center", formatter: function (value, row, index) {
            return formatDateTime(value);
        }},
        {field: "overtime", title: "缴费有效期",align: "center", formatter: function (value, row, index) {
            return formatDateTime(value);
        }},
        {field: "price", title: "项目金额(元)",align: "center", formatter: function (value, row, index) {
            return value;
        }},
        {field: "status", title: "项目状态", align: "center", formatter: function (value, row, index) {
            var sta = row.status;
            var id = row.id;
            var content = '';
            if(sta == 0) content += '开启';
            else content += '关闭';
/*            if(sta == 0){
                content += '<button class="btn btn-xs btn-default " onclick="updateStatus('+sta+','+id+')"><i class="fa fa-arrow-down"></i>开启</button>';
            }else{
                content += '<button class="btn btn-xs btn-info " onclick="updateStatus('+sta+','+id+')"><i class="fa fa-arrow-up"></i>关闭</button>';
            }*/
            return content;
        }},
/*        {field: "other", title: "编辑", align: "center", formatter: function (value, row, index) {
            var html = '';
            html += '<a class="btn btn-info btn-sm btn-outline" href="javascript:void(0);" title="修改缴费对象" onclick=\'updateChargeItems('+JSON.stringify(row)+')\' >修改缴费对象</a>';
            html += ' <a  class="btn btn-danger btn-sm btn-outline" href="javascript:void(0);" title="查看缴费情况" onclick=\'chargeUserInfo('+JSON.stringify(row)+')\'>查看缴费情况</a>';
            return html;
            var html = '';
            html += '<a class="btn btn-info btn-sm btn-outline" href="javascript:void(0);" title="编辑" onclick=\'addOrEdit('+JSON.stringify(row)+')\' >编辑</a>';
            html +='&nbsp';
            html += '<a  class="btn btn-danger btn-sm btn-outline" href="javascript:void(0);" title="删除" onclick=\'removeData('+JSON.stringify(row)+')\'>删除</a>';
            return html;
        }}*/
    ];

    function refund(rowData) {
        var url = "/order/refund";
        var params = {oid : rowData.payOid};
        var result = {succ:'退款成功！',fail:'退款失败！'};
        layer.msg("确定退款吗？", {
            shade: [0.1, '##f5f5f5'],
            time: 0 //不自动关闭
            ,btn: ['确定','取消']
            ,yes: function(index){
                layer.close(index);
                myAjax(url,params,handle);
                function handle(data, params){
                    var msg = (data.msg == undefined ? '':','+data.msg);
                    if(data.success) {
                        layer.msg(result.succ, {icon: 1,shade: 0.01});
                        $sub2Table.bootstrapTable('refresh', {url : serverUrl + '/charge/getChargeItemPager?cid=' + rowData.id});
                    }else{
                        layer.msg(result.fail + msg, {icon: 1,shade: 0.01});
                    }
                }
            },btn2: function(index, layero){
            }
        });
    }

    function updateChargeItems(rowData) {
        var index= layer.open({
            type: 1 , shade: 0.01,
            id: 'sub4Area', //设定一个id，防止重复弹出
            title: '修改缴费对象',
            area: ['500px','600px'],
            content: $('.content-view-sub-4'),
            btn: ['提交', '关闭'],
            yes:function(index){
                var arr = [];
                var idlist = document.getElementById("sub4Area").getElementsByClassName('green');
                for (var i = 0; i < idlist.length; i++) {
                    var id = idlist[i].getAttribute('data-uid');
                    arr.push(id)
                }
                var result = {succ:'添加成功！',fail:'添加失败！'};
                var params = {cid : rowData.id, uids : arr};
                console.log(params);
                var url = "/charge/updateChargeItemUids";
                layer.close(index);
                myAjax(url,params,handle);
                function handle(data, params){
                    var msg = (data.msg == undefined ? '':','+data.msg);
                    if(data.success) {
                        layer.msg(result.succ, {icon: 1,shade: 0.01});
                    }else{
                        layer.msg(result.fail + msg, {icon: 1,shade: 0.01});
                    }
                }
            },
            shadeClose: true, //开启遮罩关闭
            success: function(layero, index){
                var params = {cid:rowData.id};
                var url = "/charge/getAllChargeClasses";
                myAjax(url,params,handle);
                function handle(data, params){
                    var msg = (data.msg == undefined ? '':','+data.msg);
                    if(data.success) {
                        var data = {list: data.data};
                        var html = template("scriptChargeItems", data);
                        document.getElementById("chargeItems").innerHTML = html;
                        $(".namelist li span").click(function () {
                            var status = $(this).attr('data-status');
                            if (status == 0) {
                                $(this).attr('data-status', 1)
                                $(this).removeClass('gray');
                                $(this).addClass('green')
                            } else if (status == 1) {
                                $(this).attr('data-status', 0)
                                $(this).removeClass('green');
                                $(this).addClass('gray')
                            } else {
                            }
                        })
                    }else{
                        layer.msg(result.fail + msg, {icon: 1,shade: 0.01});
                    }
                }
            }
        });
    }

    function chargeUserInfo(rowData) {
        var index= layer.open({
            type: 1 , shade: 0.01,
            id: 'sub2Area', //设定一个id，防止重复弹出
            title: '缴费情况',
            area: ['900px','500px'],
            content: $('.content-view-sub-2'),
            shadeClose: true, //开启遮罩关闭
        });
        $sub2Table.bootstrapTable('refresh', {url : serverUrl + '/charge/getChargeItemPager?cid=' + rowData.id});
    }

    function updateUserChargeInfoDesc(rowData) {
        var index= layer.open({
            type: 1 , shade: 0.01,
            id: 'sub3Area', //设定一个id，防止重复弹出
            title: '修改缴费对象',
            area: ['500px','150px'],
            content: $('.content-view-sub-3'),
            btn: ['提交', '关闭'],
            yes:function(index){
                var desc= $.trim($('#infoDesc').val());
                var result = {succ:'添加成功！',fail:'添加失败！'};
                var params = {};
                var url = "/charge/updateChargeItemDesc";
                layer.close(index);
                params.cid = rowData.id;
                params.uid = rowData.uid;
                params.desc = desc;

                myAjax(url,params,handle);
                function handle(data, params){
                    var msg = (data.msg == undefined ? '':','+data.msg);
                    if(data.success) {
                        layer.msg(result.succ, {icon: 1,shade: 0.01});
                        $sub2Table.bootstrapTable('refresh', {url : serverUrl + '/charge/getChargeItemPager?cid=' + rowData.id});
                    }else{
                        layer.msg(result.fail + msg, {icon: 1,shade: 0.01});
                    }
                }
            },
            shadeClose: true, //开启遮罩关闭
            success: function(layero, index){
                $('#infoDesc').val(rowData.desc);
            }
        });
    }

    //添加修改
    function add(){
        formReset();
        var index= layer.open({
            type: 1 , shade: 0.01,
            id: 'area', //设定一个id，防止重复弹出
            title: '添加',
            area: ['40%','40%'],
            content: $('.content-view'),
            btn: ['提交', '关闭'],
            yes:function(index){
                var arrSubInfo = [];
                for(var one in subsMap) {
                    var sign = $('#' + one).is(':checked');
                    var price = $('#subPrice'+subsMap[one].id).val();
                    if(sign && price) {
                        var subInfo = {id:subsMap[one].id, name:subsMap[one].name, price:price};
                        arrSubInfo.push(subInfo);
                    }
                }
                var chargeItemPricesJson = JSON.stringify(arrSubInfo);
                var name= $.trim($('#name').val());
                var desc= $.trim($('#desc').val());
                var ot=$("#overtime").val();
                var overtime = new Date(ot).getTime();
                var status=$("#status").val();
                var result = {succ:'添加成功！',fail:'添加失败！'};
                var params = {};
                var url = "/charge/add";
                layer.close(index);
                params.sid = schoolId;
                params.name = name;
                params.desc = desc;
                params.chargeItemPricesJson = chargeItemPricesJson;
                params.overtime = overtime;
                params.status = status;

                myAjax(url,params,handle);
                function handle(data, params){
                    var msg = (data.msg == undefined ? '':','+data.msg);
                    if(data.success) {
                        layer.msg(result.succ, {icon: 1,shade: 0.01});
                        handleTable("", 3, serverUrl + "/charge/getUserPager?sid=" + schoolId);
                    }else{
                        layer.msg(result.fail + msg, {icon: 1,shade: 0.01});
                    }
                }
            },
            shadeClose: true, //开启遮罩关闭
            success: function(layero, index){
                var url = "/charge/getAllSubs?sid=" + schoolId;
                myAjax(url,{},handle);
                function handle(data, params) {
                    var msg = (data.msg == undefined ? '':','+data.msg);
                    if(data.success) {
                        for(var i = 0; i < data.data.length; i++) {
                            subsMap['sub' + data.data[i].id] = data.data[i];
                        }
                        var data = {list: data.data};
                        var html = template("scriptChargeSubs", data);
                        document.getElementById("selectSubs").innerHTML = html;
                    }else{
                        layer.msg(result.fail + msg, {icon: 1,shade: 0.01});
                    }
                }
            }
        })
    }
    function reInitTable(){
        $table.bootstrapTable('refreshOptions',{page:1});
    }
    function updateStatus(sta,id){
        if(sta==0){
            sta=1;
        }else{
            sta=0;
        }
        var url = "/charge/updateStatus";
        var param = {id:id,status:sta};
        myAjax(url,param,handle);
        function handle(data,param){
            var msg = (data.msg == undefined ? '':','+data.msg);
            if(data.success) {
                layer.msg('切换成功!', {icon: 1,shade: 0.01});
                handleTable(param,1);
            }else{
                layer.msg('切换失败'+msg, {icon: 1,shade: 0.01});
            }
        }
    }

    function formReset(){
        $("#areaForm")[0].reset();
    }
    //初始化页面上面的按钮事件
    var ButtonInit = function () {
        var oInit = new Object();
        oInit.Init = function () {
            $('#search').click(reInitTable);
            $('#btn_add').click(add);
        };

        return oInit;
    };
    //主函数
    $(function () {
        var Table = new TableInit(columns);
        Table.Init();

        var Sub2Table = new Sub2TableInit(sub2Columns);
        Sub2Table.Init();

        var oButtonInit = new ButtonInit();
        oButtonInit.Init();

        laydate.render({
            elem: '#overtime'
            ,type: 'datetime'
        });
        laydate.render({
            elem: '#startTime'
            ,type: 'datetime'
        });
        laydate.render({
            elem: '#endTime'
            ,type: 'datetime'
        });

    });

</script>

<script type="text/html" id="scriptChargeItems">
    <%for(var i=0;i<list.length;i++){%>
    <div>
        <div>
            <div class="fl modal-body-top">
                <%=list[i].className%>
            </div>
        </div>
        <ul class="namelist">
            <%for(var j=0;j<list[i].chargeUsers.length;j++){%>
            <li>
                <%if(list[i].chargeUsers[j].status == 0){%>
                <span data-uid="<%=list[i].chargeUsers[j].uid%>" data-status="<%=list[i].chargeUsers[j].status%>" class="gray"></span>
                <%}else if(list[i].chargeUsers[j].status == 1){%>
                <span data-uid="<%=list[i].chargeUsers[j].uid%>" data-status="<%=list[i].chargeUsers[j].status%>" class="green"></span>
                <%}else if(list[i].chargeUsers[j].status == 2){%>
                <span data-uid="<%=list[i].chargeUsers[j].uid%>" data-status="<%=list[i].chargeUsers[j].status%>" class="red"></span>
                <%}%>
                <%=list[i].chargeUsers[j].userName%>
            </li>
            <%}%>
            <div style="clear: both"></div>
        </ul>
    </div>
    <%}%>
</script>

<script type="text/html" id="scriptChargeSubs">
    <%for(var i=0; i<list.length; i++){%>
    <li>
        <input id="sub<%=list[i].id %>" type="checkbox" /> <span><%=list[i].name %></span> <input id="subPrice<%=list[i].id %>" type="text" placeholder="请输入金额"/>
    </li>
    <%}%>
</script>

</html>
